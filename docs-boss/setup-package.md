# Set up a BOSS package

## How to set up a BOSS package?

Now that you have configured your **BOSS** work area, you can start developing packages. In theory, you can start from scratch. We'll have a short look at that procedure here, because it gives some insight into the default structure of a package in CMT.

### Structure of a CMT package

As explained in [The BOSS Analysis Framework](intro.md), BOSS is organised through packages. Packages are components of the entire BOSS framework on which individuals like you work independently. Each package on itself can have several versions that are maintained by you through CMT.

To create an empty package \(with a default format\), use the following command:

```text
cmt create MyFirstPackage MyFirstPackage-00-00-01
```

Here, the name `MyFirstPackage` is just an example name of the package. The name will be used as the folder name as well. The second string describes the version of the package. Within BESIII, this string repeats the package name, followed by 6 digits: `-<major id>-<minor id>-<patch id>`. These digits should increase along with changes you make. Increase the:

* `patch id` if you only made some simple bug fixes that don't change the interface \(`.h` header file\);
* `minor id` if you only made changes that are backward compatible, such as new functionality;
* `major id` if you modified the interface \(header file\) that require you to completely recompile the package.

The above only becomes relevant as when you start developing packages, so you can forget about this for now.

{% hint style="warning" %}
Note that the folder structure `MyFirstPackage/MyFirstPackage-00-00-01` is **required** for `cmt` to work properly. If you don't have a subfolder with a string for the version as above, `cmt broadcast` won't work!
{% endhint %}

The result of the above command is a new folder, that we'll navigate into:

```text
cd MyFirstPackage/MyFirstPackage-00-00-01
```

Within this folder, you see the core of a default CMT package:

* `cmd`: a folder that contains all files necessary for management of the package through CMT. There are 6 files:
  * **`cleanup.csh`**

    This is a `tcsh` script that allows you to clean all installation files of the package \(for instance useful when you are moving to a new version\).

  * **`cleanup.sh`** The same as `cleanup.csh`, but than in `bash` shell script format.
  * **`Makefile`**  A file that is necessary for compilation through `make`/`cmake`/`gmake`.
  * **`requirements`**

    The most important of file! Here, you define which other packages within BOSS your own package requires \(it defines the _dependencies_\).  
    You can have a closer look at this file for the `TestRelease` example package to see how this file is ordinarily formatted.

  * **`setup.csh`**  Another important file. It is used when 'broadcasting' your package.
  * **`setup.sh`**: the same, but now in `bash` shell script format.
* **`src`**: an empty folder that will hold your `c++` source code \(`.cxx` files\). Optionally, corresponding headers of these files are usually placed in a folder called `share` but this folder is not generated by default.

For more information see:  
[http://polywww.in2p3.fr/activites/physique/glast/workbook/pages/cmtMRvcmt/cmtIntroduction.htm](http://polywww.in2p3.fr/activites/physique/glast/workbook/pages/cmtMRvcmt/cmtIntroduction.htm)

### Updating a package

{% hint style="warning" %}
**@todo**: Investigate how to formally update a package.
{% endhint %}

## Example packages



### The `TestRelease` example package

The typical example package to get you started is the `TestRelease` package. We will need to copy this package into your [your work area](../#set-up-your-work-area). So let's navigate there:

```text
cd /ihepbatch/bes/$USER/workarea-7.0.3
```

Now copy the typical `TestRelease` example to your _work area_ and navigate into it:

```text
cp â€“r $BesArea/TestRelease ./
cd TestRelease/TestRelease-*
```

You are now in a folder like `TestRelease/TestRelease-00-00-86`, where `00-00-86` represents the version. Using `ls`, you can see that it contains some folders:

* `cmt`: the _Configuration Management Tool_ that you will use to connect to **BOSS**
* `CVS`: a folder used for version management.
* `run`: which contains the `jobOptions` that are run with `boss.exe`

We can set up the `TestRelease` by going into `cmt` and 'broadcasting' to **BOSS** from there:

```bash
cd cmt
cmt broadcast      # 
cmt config         # perform setup and cleanup scripts
cmt broadcast make # build executables from source code in package
source setup.sh    # set bash variables
```

This will initialise the package so that you can run it from the run folder. This is done using `boss.exe`:

```text
cd ../run
boss.exe jobOptions_sim.txt
```

which, in this case, will run a Monte Carlo simulation.

Note that in step 7 [when we set up the work area](../#set-up-your-work-area) we added a line to the `.bashrc` that ensures that the `TestRelease` package is loaded every time you log in, so you won't have to do this every time yourself.

## The `Rhopi` algorithm

Location of the `RhopiAlg`:

```bash
/afs/ihep.ac.cn/bes3/offline/Boss/$BOSSVERSION/Analysis/Physics/RhopiAlg/RhopiAlg-00-00-23
```

* Aim \(physics\)
* What this will learn:
  * `fit4c` versus `fit5c`

## Adding packages to BOSS

@todo Go through Chinese documentation and [this page](https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Getting_Started) and write out.  
[https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Getting\_Started](https://docbes3.ihep.ac.cn/~offlinesoftware/index.php/Getting_Started)

